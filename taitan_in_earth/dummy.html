<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>クリア！おめでとう！</title>
    <style>
      :root {
        --bg1: #0f1020; /* deep */
        --bg2: #0b1028;
        --accent1: #ff3ca6;
        --accent2: #7ae0ff;
        --accent3: #ffd36b;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: system-ui,-apple-system,Segoe UI,Roboto,\"Hiragino Kaku Gothic ProN\",\"Noto Sans JP\",sans-serif;
      }
      body {
        background: radial-gradient(
            1200px 600px at 10% 20%,
            rgba(123, 58, 211, 0.12),
            transparent
          ),
          radial-gradient(
            800px 500px at 90% 80%,
            rgba(255, 60, 150, 0.06),
            transparent
          ),
          linear-gradient(180deg, var(--bg1), var(--bg2));
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        color: #fff;
      }

      /* animated aurora behind */
      .aurora {
        position: absolute;
        inset: -10% -20% auto -20%;
        height: 120%;
        background: linear-gradient(
          90deg,
          rgba(126, 58, 255, 0.18),
          rgba(255, 60, 150, 0.12),
          rgba(122, 224, 255, 0.09)
        );
        filter: blur(60px);
        transform: rotate(-8deg);
        animation: drift 10s ease-in-out infinite alternate;
        pointer-events: none;
        mix-blend-mode: screen;
      }
      @keyframes drift {
        to {
          transform: translateY(-40px) rotate(-6deg) scale(1.05);
        }
      }

      .container {
        position: relative;
        z-index: 2;
        padding: 2rem;
        text-align: center;
        width: min(1100px, 90%);
        display: grid;
        gap: 1rem;
        place-items: center;
      }

      h1 {
        margin: 0;
        font-size: clamp(36px, 10vw, 120px);
        line-height: 0.9;
        font-weight: 900;
        letter-spacing: 0.02em;
        text-transform: none;
        background: linear-gradient(
          90deg,
          var(--accent1),
          var(--accent2),
          var(--accent3)
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 8px 30px rgba(0, 0, 0, 0.6),
          0 0 30px rgba(255, 60, 150, 0.18);
        transform: translateY(-6px);
      }

      .glow {
        position: relative;
        display: inline-block;
        padding: 0.2em 0.6em;
        border-radius: 14px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.04),
          rgba(255, 255, 255, 0.02)
        );
        box-shadow: 0 6px 40px rgba(123, 58, 211, 0.12),
          inset 0 -2px 8px rgba(255, 255, 255, 0.02);
      }

      .sub {
        font-size: clamp(14px, 2.8vw, 22px);
        opacity: 0.95;
        margin-top: 0.2rem;
        color: rgba(255, 255, 255, 0.9);
      }

      /* neon ribbon */
      .ribbon {
        margin-top: 0.6rem;
        padding: 0.4rem 1rem;
        border-radius: 999px;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.04),
          rgba(255, 255, 255, 0.02)
        );
        box-shadow: 0 10px 30px rgba(122, 224, 255, 0.06);
        display: inline-flex;
        gap: 0.6rem;
        align-items: center;
      }

      .btn {
        -webkit-tap-highlight-color: transparent;
        appearance: none;
        border: 0;
        padding: 0.6rem 1rem;
        border-radius: 999px;
        font-weight: 700;
        cursor: pointer;
        background: linear-gradient(90deg, var(--accent2), var(--accent1));
        color: #081022;
        box-shadow: 0 8px 28px rgba(122, 224, 255, 0.12),
          0 2px 6px rgba(0, 0, 0, 0.4);
        transform: translateY(0);
        transition: transform 0.12s ease, box-shadow 0.12s ease;
      }
      .btn:active {
        transform: translateY(2px);
        box-shadow: 0 6px 20px rgba(122, 224, 255, 0.08);
      }

      /* confetti canvas cover */
      canvas.confetti {
        position: fixed;
        inset: 0;
        z-index: 3;
        pointer-events: none;
      }

      /* footer credits */
      .credit {
        position: absolute;
        right: 18px;
        bottom: 14px;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.5);
        z-index: 4;
      }

      /* subtle floating sparkles */
      .sparkle {
        position: absolute;
        z-index: 1;
        filter: blur(6px);
        mix-blend-mode: screen;
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation: none !important;
          transition: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="aurora" aria-hidden></div>

    <div class="container" role="main">
      <div class="glow">
        <h1>
          クリア！<span style="display: inline-block; margin-left: 0.28em"
            >おめでとう！</span
          >
        </h1>
      </div>
      <div class="sub">すごい！よく頑張ったね — 次の冒険へ進もう！</div>

      <div class="ribbon" aria-hidden>
        <button class="btn" id="replay">もう一度祝う</button>
        <button class="btn" id="toggleSound" aria-pressed="true">
          サウンド：オン
        </button>
      </div>
    </div>

    <canvas class="confetti" id="confetti"></canvas>
    <div class="credit">Made with ✨ by your friendly assistant</div>

    <script>
      // Confetti implementation (lightweight, no libs)
      const canvas = document.getElementById("confetti");
      const ctx = canvas.getContext("2d");
      let W = (canvas.width = innerWidth);
      let H = (canvas.height = innerHeight);

      window.addEventListener("resize", () => {
        W = canvas.width = innerWidth;
        H = canvas.height = innerHeight;
      });

      const rand = (a, b) => Math.random() * (b - a) + a;
      const colors = [
        "#ff3ca6",
        "#7ae0ff",
        "#ffd36b",
        "#7eff9a",
        "#fff",
        "#b28bff",
      ];

      class Piece {
        constructor() {
          this.reset();
        }
        reset() {
          this.x = rand(0, W);
          this.y = rand(-40, -10);
          this.w = rand(6, 14);
          this.h = rand(8, 18);
          this.vx = rand(-1.5, 1.5);
          this.vy = rand(2, 6);
          this.spin = rand(-0.2, 0.2);
          this.angle = rand(0, Math.PI * 2);
          this.color = colors[Math.floor(rand(0, colors.length))];
          this.life = rand(60, 160);
          this.t = 0;
        }
        update() {
          this.t++;
          this.x += this.vx;
          this.y += this.vy;
          this.vy += 0.03; // gravity
          this.angle += this.spin;
          if (
            this.y > H + 60 ||
            this.x < -80 ||
            this.x > W + 80 ||
            this.t > this.life
          )
            this.reset();
        }
        draw(ctx) {
          ctx.save();
          ctx.translate(this.x, this.y);
          ctx.rotate(this.angle);
          ctx.fillStyle = this.color;
          ctx.fillRect(-this.w / 2, -this.h / 2, this.w, this.h);
          ctx.restore();
        }
      }

      const pieces = Array.from({ length: 120 }, (_) => new Piece());
      let running = false;

      function loop() {
        ctx.clearRect(0, 0, W, H);
        for (const p of pieces) {
          p.update();
          p.draw(ctx);
        }
        requestAnimationFrame(loop);
      }

      // fire a burst
      function burst() {
        for (const p of pieces) {
          p.reset();
          p.x = W / 2 + rand(-120, 120);
          p.y = H / 2 + rand(-30, 30);
          p.vx = rand(-7, 7);
          p.vy = rand(-12, -4);
        }
        if (!running) {
          running = true;
          loop();
        }
      }

      // Sparkle + pop sound
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      let soundOn = true;
      function popSound() {
        if (!soundOn) return;
        try {
          const o = audioCtx.createOscillator();
          const g = audioCtx.createGain();
          o.type = "sine";
          o.frequency.setValueAtTime(rand(600, 1200), audioCtx.currentTime);
          g.gain.setValueAtTime(0.001, audioCtx.currentTime);
          g.gain.linearRampToValueAtTime(0.06, audioCtx.currentTime + 0.01);
          g.gain.exponentialRampToValueAtTime(
            0.0001,
            audioCtx.currentTime + 0.35
          );
          o.connect(g);
          g.connect(audioCtx.destination);
          o.start();
          o.stop(audioCtx.currentTime + 0.4);
        } catch (e) {
          /* audio blocked */
        }
      }

      // initial burst and small repeats
      burst();
      popSound();
      let repeat = 0;
      const repeatId = setInterval(() => {
        burst();
        popSound();
        if (++repeat > 3) {
          clearInterval(repeatId);
        }
      }, 900);

      document.getElementById("replay").addEventListener("click", () => {
        burst();
        popSound();
      });
      document.getElementById("toggleSound").addEventListener("click", (e) => {
        soundOn = !soundOn;
        e.currentTarget.textContent =
          "サウンド：" + (soundOn ? "オン" : "オフ");
        e.currentTarget.setAttribute("aria-pressed", String(soundOn));
        if (soundOn) audioCtx.resume();
      });

      // small floating sparkles using DOM for nice layering
      const sparkleCount = 10;
      for (let i = 0; i < sparkleCount; i++) {
        const el = document.createElement("div");
        el.className = "sparkle";
        el.style.width = "220px";
        el.style.height = "220px";
        el.style.left = rand(-10, 90) + "%";
        el.style.top = rand(0, 70) + "%";
        el.style.background =
          "radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.06) 14%, transparent 40%)";
        el.style.opacity = rand(0.06, 0.18);
        el.style.transform = "scale(" + rand(0.4, 1.6) + ")";
        el.style.pointerEvents = "none";
        document.body.appendChild(el);
        el.animate(
          [
            { transform: "translateY(0px) rotate(0deg)" },
            { transform: "translateY(-24px) rotate(20deg)" },
            { transform: "translateY(0px) rotate(-10deg)" },
          ],
          {
            duration: rand(8000, 16000),
            iterations: Infinity,
            delay: rand(-2000, 2000),
            direction: "alternate",
            easing: "ease-in-out",
          }
        );
      }

      // accessibility: allow keyboard to trigger replay
      window.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          burst();
          popSound();
        }
      });

      // try to wake audio on user gesture for some browsers
      document.addEventListener(
        "pointerdown",
        () => {
          if (audioCtx.state !== "running") audioCtx.resume();
        },
        { once: true }
      );
    </script>
  </body>
</html>
